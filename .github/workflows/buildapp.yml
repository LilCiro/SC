# Bu i≈ü akƒ±≈üƒ± a≈üaƒüƒ±daki i≈ü akƒ±≈ülarƒ±ndan b√ºy√ºk √∂l√ß√ºde esinlenilmi≈ütir:
# https://github.com/arichornlover/uYouEnhanced/blob/main/.github/workflows/buildapp.yml
# https://github.com/ISnackable/YTCubePlus/blob/main/.github/workflows/Build.yml
# https://github.com/BandarHL/BHTwitter/actions/workflows/build.yml

name: SCInsta'yƒ± Derle ve Paketle üì¶üöÄ‚ú®üõ†Ô∏è

on:
  workflow_dispatch: # Bu i≈ü akƒ±≈üƒ±nƒ± GitHub aray√ºz√ºnden manuel olarak tetiklemeye izin verir. üåêüëÜ‚öôÔ∏è
    inputs:
      decrypted_instagram_url: # ≈ûifresi √ß√∂z√ºlm√º≈ü Instagram IPA'sƒ±nƒ±n doƒürudan URL'si. üîóüîêüì±üì•
        description: "≈ûifresi √ß√∂z√ºlm√º≈ü Instagram IPA'sƒ±nƒ±n doƒürudan URL'si"
        default: ""
        required: true
        type: string
      app_name: # Uygulama adƒ± giri≈üi (opsiyonel). üìùüì±‚ú®
        description: "Uygulama Adƒ± (Opsiyonel - Bo≈ü bƒ±rakƒ±lƒ±rsa varsayƒ±lan kullanƒ±lƒ±r)"
        default: ""
        required: false
        type: string
      developer_name: # Geli≈ütirici adƒ± giri≈üi (opsiyonel). üßë‚Äçüíª‚úçÔ∏èüåü
        description: "Geli≈ütirici Adƒ± (Opsiyonel - Bo≈ü bƒ±rakƒ±lƒ±rsa varsayƒ±lan kullanƒ±lƒ±r)"
        default: ""
        required: false
        type: string
      scinsta_version: # SCInsta tweak s√ºr√ºm numarasƒ± giri≈üi (opsiyonel). üî¢‚ú®üîÑ
        description: "SCInsta Tweak S√ºr√ºm√º (Opsiyonel - Bo≈ü bƒ±rakƒ±lƒ±rsa control dosyasƒ±ndan alƒ±nƒ±r)"
        default: ""
        required: false
        type: string
      instagram_app_version: # Instagram uygulama s√ºr√ºm numarasƒ± giri≈üi (opsiyonel). üì±üî¢‚ú®
        description: "Instagram Uygulama S√ºr√ºm√º (Opsiyonel - Bo≈ü bƒ±rakƒ±lƒ±rsa orijinal IPA'nƒ±n s√ºr√ºm√º kullanƒ±lƒ±r)"
        default: ""
        required: false
        type: string
      remove_app_icon: # Uygulama fotoƒürafƒ±nƒ± kaldƒ±rma se√ßeneƒüi (opsiyonel). üñºÔ∏è‚ùåüö´
        description: "Uygulama Fotoƒürafƒ±nƒ± Kaldƒ±r (Opsiyonel - Se√ßilirse bo≈ü ikonla derlenir)"
        default: false
        required: false
        type: boolean
      upload_artifact: # Olu≈üturulan paketi GitHub Artifacts'a y√ºkleyip y√ºklemeyeceƒüi. üì§üìÇ‚úÖ‚òÅÔ∏è
        description: "Derleme sonucunu (artifact) y√ºkle"
        default: true
        required: false
        type: boolean
          
concurrency: # Aynƒ± anda birden fazla √ßalƒ±≈ütƒ±rmanƒ±n nasƒ±l y√∂netileceƒüini belirler. üö¶üîÑ‚è≥üö´
  group: ${{ github.workflow }}-${{ github.ref }} # Aynƒ± i≈ü akƒ±≈üƒ± ve referans i√ßin yalnƒ±zca bir √ßalƒ±≈ütƒ±rmaya izin verir.
  cancel-in-progress: true # Devam eden √ßalƒ±≈ütƒ±rmalarƒ± iptal eder.

jobs:
  build: # Derleme i≈üi. üèóÔ∏èüíªüçèüì¶
    name: SCInsta'yƒ± Derle üöÄ‚ú®‚úÖüõ†Ô∏è
    runs-on: macos-latest # ƒ∞≈üin en son macOS s√ºr√ºm√ºnde √ßalƒ±≈üacaƒüƒ±nƒ± belirtir. üçéüíª
    permissions: # ƒ∞≈üin sahip olduƒüu izinler. üîëüîí
      contents: write # Depo i√ßeriƒüine yazma izni verir. ‚úçÔ∏è

    steps: # ƒ∞≈üin adƒ±mlarƒ±. üë£‚û°Ô∏è
      - name: Ana Depoyu √áek üì•üìÇüîóüîÑ
        uses: actions/checkout@v4 # Depoyu √ßekmek i√ßin checkout eylemini kullanƒ±r.
        with:
          path: main # Depoyu 'main' dizinine √ßeker.
          submodules: recursive # Alt mod√ºlleri de √∂zyinelemeli olarak √ßeker.

      - name: Baƒüƒ±mlƒ±lƒ±klarƒ± Y√ºkle üì¶üîß‚öôÔ∏èüìö
        run: brew install ldid dpkg make # Gerekli ara√ßlarƒ± (ldid, dpkg, make) Homebrew ile y√ºkler.

      - name: PATH Ortam Deƒüi≈ükenini Ayarla üõ£Ô∏èüåç‚öôÔ∏è‚û°Ô∏è
        run: echo "$(brew --prefix make)/libexec/gnubin" >> $GITHUB_PATH # 'make' komutunun doƒüru s√ºr√ºm√ºn√º PATH'e ekler.

      - name: Theos'u Kur üçèüõ†Ô∏è‚öôÔ∏èüöÄ
        uses: actions/checkout@v4 # Theos deposunu √ßekmek i√ßin checkout eylemini kullanƒ±r.
        with:
          repository: theos/theos # Theos'un GitHub deposu.
          ref: master # Master branch'ini √ßeker.
          path: ${{ github.workspace }}/theos # Theos'u √ßalƒ±≈üma alanƒ±ndaki 'theos' dizinine √ßeker.
          submodules: recursive # Theos'un alt mod√ºllerini de √∂zyinelemeli olarak √ßeker.
            
      - name: SDK √ñnbellekleme üíæ‚ö°Ô∏èüì•üîÑ
        id: SDK # Bu adƒ±m i√ßin bir ID belirler.
        uses: actions/cache@v4 # √ñnbellekleme eylemini kullanƒ±r.
        env:
          cache-name: iPhoneOS14.5.sdk # √ñnbellek adƒ±.
        with:
          path: ${{ github.workspace }}/theos/sdks/ # √ñnbelleƒüe alƒ±nacak dizin.
          key: ${{ env.cache-name }} # √ñnbellek anahtarƒ±.
          restore-keys: ${{ env.cache-name }} # Geri y√ºklenecek anahtarlar.

      - name: iOS SDK ƒ∞ndir ‚¨áÔ∏èüì±üåêüì¶
        if: steps.SDK.outputs.cache-hit != 'true' # Eƒüer SDK √∂nbellekte yoksa √ßalƒ±≈üƒ±r.
        run: |
          git clone --quiet -n --depth=1 --filter=tree:0 https://github.com/xybp888/iOS-SDKs/ # iOS SDK'larƒ±nƒ± i√ßeren depoyu klonlar.
          cd iOS-SDKs # Dizin deƒüi≈ütirir.
          git sparse-checkout set --no-cone iPhoneOS14.5.sdk # Sadece belirtilen SDK'yƒ± √ßeker.
          git checkout # √áekilen SDK'yƒ± etkinle≈ütirir.
          mv *.sdk $THEOS/sdks # SDK'yƒ± Theos'un SDK dizinine ta≈üƒ±r.
        env:
          THEOS: ${{ github.workspace }}/theos # THEOS ortam deƒüi≈ükenini ayarlar.

      - name: Instagram IPA'yƒ± Hazƒ±rla üì±üì¶üîóüì•
        run: |
          cd main # Ana depo dizinine gider.
          mkdir -p packages # 'packages' dizini olu≈üturur.
          wget "$Instagram_URL" --no-verbose -O packages/com.burbn.instagram.ipa # Belirtilen URL'den Instagram IPA'sƒ±nƒ± indirir.
          ls -la packages # 'packages' dizininin i√ßeriƒüini listeler.
            
        env:
          THEOS: ${{ github.workspace }}/theos # THEOS ortam deƒüi≈ükenini ayarlar.
          Instagram_URL: ${{ inputs.decrypted_instagram_url }} # Giri≈ülerden alƒ±nan Instagram URL'sini kullanƒ±r.

      - name: SCInsta ve Instagram S√ºr√ºm√ºn√º Belirle üè∑Ô∏èüî¢‚ú®üìÑ
        id: versions
        run: |
          # SCInsta Tweak S√ºr√ºm√ºn√º Belirle
          SCINSTA_TWEAK_VERSION=""
          if [[ -n "${{ inputs.scinsta_version }}" ]]; then
            SCINSTA_TWEAK_VERSION="${{ inputs.scinsta_version }}"
            echo "SCInsta tweak s√ºr√ºm√º manuel olarak ayarlandƒ±: ${SCINSTA_TWEAK_VERSION}"
          else
            SCINSTA_TWEAK_VERSION=$(awk '/Version:/ {print $2}' main/control)
            echo "SCInsta tweak s√ºr√ºm√º control dosyasƒ±ndan alƒ±ndƒ±: ${SCINSTA_TWEAK_VERSION}"
          fi
          echo "SCINSTA_TWEAK_VERSION=${SCINSTA_TWEAK_VERSION}" >> "$GITHUB_ENV"
          echo "scinsta_version=${SCINSTA_TWEAK_VERSION}" >> "$GITHUB_OUTPUT"

          # Instagram Uygulama S√ºr√ºm√ºn√º Belirle (bu kƒ±sƒ±m build.sh'ye arg√ºman olarak iletilmeli)
          INSTAGRAM_APP_VERSION=""
          if [[ -n "${{ inputs.instagram_app_version }}" ]]; then
            INSTAGRAM_APP_VERSION="${{ inputs.instagram_app_version }}"
            echo "Instagram uygulama s√ºr√ºm√º manuel olarak ayarlandƒ±: ${INSTAGRAM_APP_VERSION}"
          else
